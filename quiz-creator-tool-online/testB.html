<!--
File: testB.html
Contract: EU contract 2022-FR01-KA220-HED-000023509
Project: FitNESS 2 ERASMUS+
File Created: Wednesday, 20th September 2023
Author: Steward OUADI
-----
Last Modified: Wednesday, 20th September 2023
Modified By: Steward OUADI
-->

<html>
<!-- Test for beginners - designed by Olivier Vitrac - rev. $ 2020-12-04 $ -->

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FITNess test</title>
  <link type="text/css" rel="stylesheet" href="src/quiz.css" />
</head>

<body>
  <div id="submit-results-proposal">
    <button id="submit-results">Submit results by email</button>
    <p>By clicking on the button above, you will send your answers to the creator of this quiz.</p>
  </div>

  <!-- <button style="padding: 1px; position:unset;" onclick="convertQuestions()">Show questions</button> -->
  <pre id="output"></pre>
  <h1>
    <table>
      <tr>
        <td>
          <img src="src/Fitness2_logo.png" referrerpolicy="no-referrer" alt="FITNESS" title="ERASMUS+ Project" class=""
            width="128px" height="" />
        </td>
        <td>ERASMUS+ programme (contract 2022-FR01-KA220-HED-000023509)</td>
      </tr>
    </table>
  </h1>
  <div id="qbutton">
    <button id="previous"></button>
    <button id="next"></button>
    <button id="submit"></button>
  </div>
  <div id="results"></div>
  <div class="quiz-container">
    <div id="quiz">
      <p>Click on the "Browse" button to import the Markdown file containing your questions and display them using the
        FITNESS quiz format.
      </p>
    </div>

  </div>


  <!-- Include libraries -->
  <script src="src/libraries/math.js" type="text/javascript"></script>
  <script src="src/utils.js" type="text/javascript"></script>

  <!-- Include classes -->
  <script src="src/GlobalSlide.js"></script>
  <script src="src/RadioButtonQuizSlide.js"></script>
  <script src="src/SuggestionMenuSlide.js"></script>
  <script src="src/CheckBoxButtonQuizSlide.js"></script>
  <script src="src/ImageOnlySlide.js"></script>



  <!-- config.js: used to get configuration -->
  <!-- <script src="src/config.js"></script> -->

  <script src="../../src/js/utils.js"></script>
  <script type="text/javascript" src="src/beginner.js"></script>

  <script>
    displaySendResultsByEmailButtonIfNecessary();

    function generateIdentifier() {
      var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      var identifier = '';

      for (var i = 0; i < 5; i++) {
        var randomIndex = Math.floor(Math.random() * characters.length);
        identifier
          += characters.charAt(randomIndex);
      }
      return identifier;
    }

    const defaultSessionIdentifier = generateIdentifier();

    var markdownContent = `Q1: One of these statements is false:
    - [ ] As a professional, I can interpret laws and their obligations
    - [x] Because we are in a democracy, all opinions on dangers and risks are acceptable
    - [ ] As a professional, I can consult authorities for opinions, supplements, or rule revisions
    - [ ] As a professional, I must continue to learn and train throughout my career
    - [ ] As a professional, I act in the interest of preserving consumer and environmental safety



    Q2: I think regulation is primarily:

    - [ ] A hindrance to free trade and the global economy
    - [ ] An administrative hassle
    - [x] A transfer of responsibility from industry to society
    - [ ] A set of common-sense rules
    - [ ] Inferior to standards



    Q3: One of these statements is false:

    - [ ] Plastic waste has doubled in the last 20 years
    - [ ] Current regulations have not encouraged the most environmentally friendly packaging and practices
    - [ ] The objectives for recyclability of packaging materials significantly increase dangers and risks
    - [ ] Some contaminants from recycled materials are eternal
    - [ ] Recycled plastic material is more expensive than virgin material
    - [ ] Recycled plastics are colored because they contain chemical substances not found in virgin material
    - [ ] Papers and cardboards are recycled for food contact without a decontamination step
    - [x] It is easy to recognize recycled material
    - [ ] Plastic recycling requires a simplification of packaging
    - [ ] Some plastic materials are hard to recycle
    - [ ] Plastics of different chemical nature can only be mixed under certain conditions
    - [ ] PET is the preferred material for hollow bodies but is not suitable for hot filling
    - [ ] Recycled polyolefins are far more contaminated than recycled PET
    - [ ] Recycled materials contain dozens, if not hundreds, of substances that are difficult to identify



    Q4: One of these statements is false?

    - [ ] You can get certified online
    - [x] You can print a certificate of compliance online for packaging
    - [ ] You can use calculations to demonstrate packaging compliance
    - [ ] Authorities must carry out measures to organize a product recall following contamination
    - [ ] Papers and cardboards in contact with food are not regulated at the European level
    - [ ] Elastomers and rubbers are specifically regulated in France
    - [ ] Contaminants can be transferred without contact with food
    - [ ] Hydrophobic contaminants cannot be transferred in aqueous phase
    - [ ] An untargeted chemical analysis searches for all identifiable compounds



    Q5: One of these statements is false?

    - [x] There is no preventive approach to chemical risks
    - [ ] The migration of substances from packaging is primarily invisible and odorless
    - [ ] The acceptable thresholds for unknown substances are not measurable
    - [ ] The majority of substances in recycled material have not been evaluated toxicologically
    - [ ] Packaging is a significant source of polyaromatic hydrocarbons
    - [ ] Regulation does not help to limit public health crises
    - [ ] A food packaging produced in A, can be filled in B and sold in C

    canBeSentByEmail:true`;

    function convertQuestions() {
      // Split the content into an array of lines
      var lines = markdownContent.split('\n');
      const configurationData = [];

      const globalSlide = {
        id: "global",
        shuffleAnswers: false,
        currentScore: 0,
      };

      configurationData.push(globalSlide);

      let currentQuestion = null;
      let answerIndex = 'a';

      lines.forEach((line) => {
        line = line.trim();

        if (line.startsWith('Q')) {
          if (currentQuestion !== null) {
            configurationData.push(currentQuestion);
          }
          currentQuestion = {
            id: line.split(':')[0].trim(),
            question: {
              text: line.split(':')[1].trim(),
            },
            answers: {},
            pointsIfCorrectAnswer: 1,
            pointsIfWrongAnswer: 0,
          };
          answerIndex = 'a';
        } else if (line.startsWith('-')) {
          const isCorrect = line.startsWith('- [x]');
          const answerText = line.split(']')[1].trim();

          currentQuestion.answers[answerIndex] = {
            text: answerText
          };
          if (isCorrect) {
            currentQuestion.correctAnswer = answerIndex;
          }
          answerIndex = String.fromCharCode(answerIndex.charCodeAt(0) + 1);
        } else if (line.startsWith('canBeSentByEmail')) {
          canBeSentByEmail = line.split(':')[1].trim();
        }
      });

      if (currentQuestion !== null) {
        configurationData.push(currentQuestion);
      }

      const result = `const configurationData = ${JSON.stringify(configurationData, null, 2)};`;
      const quizContainer = document.getElementById("quiz");
      quizContainer.innerHTML = "";
      allSlides = configurationData;
      DoQuiz();

    }

    convertQuestions();
    document.getElementById("submit-results").addEventListener("click", function () {
      var popup = window.open("", "popup", "width=400,height=300");

      var popupContent = "<h2>Send results by email</h2>" +
        "<label for='input-id'>Identifier: (you can change it to write your own)</label>" +
        "<input type='text' id='input-id' value='" + defaultSessionIdentifier + "'>" +
        "<button id='btn-send'>Send</button>";

      popup.document.write(popupContent);

      var btnSend = popup.document.getElementById("btn-send");
      popup.document.getElementById("btn-send").addEventListener("click", function () {
        let currentFilename = "testB";
        var sessionIdentifier = popup.document.getElementById("input-id").value;
        console.log("first click")
        // Perform necessary actions to send the results via email

        console.log("clicked on send");
        var recipient1 = "olivier.vitrac@agroparistech.fr";
        var recipient2 = "steward.ouadi@agroparistech.fr";
        var title = currentFilename;
        var identifier = sessionIdentifier;
        var subject = encodeURIComponent(title + "|" + identifier);
        var content = encodeURIComponent(JSON.stringify(questionsAndUserAnswers, undefined, 2));

        var mailtoLink = "mailto:" + recipient1 + "," + recipient2 + "?subject=" + subject +
          "&body=" +
          content;

        // window.open (instead of window.location.href) so we can increase the number of devices that can handle
        // the mailto link
        window.open(mailtoLink, '_blank');



        popup.close();
      });



      // Prevent the default form submission behavior when pressing Enter
      popup.document.onkeydown = function (event) {
        if (event.key === "Enter") {
          event.preventDefault();
          return false;
        }
      };
    });
  </script>




</body>

</html>